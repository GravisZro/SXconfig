language: cpp
sudo: required
dist: trusty
compiler:
  - clang++
  - g++
os:
  - linux
  - osx
cache:
  apt: true
before_install:
  - COMPILER_NAME=$(echo $CC | sed -e s/gcc/g++-7/ -e s/clang/clang-3.8/)
  - if [ "$TRAVIS_OS_NAME-$CXX" = "linux-g++"     ]; then sudo -E apt-add-repository -y "ppa:ubuntu-toolchain-r/test"; export DEBIAN_FRONTEND=noninteractive; sudo -E apt-get -yq update &>> ~/apt-get-update.log; sudo -E apt-get -yq --no-install-suggests --no-install-recommends --force-yes install g++-7 qt4-qmake; sudo ln -srf -t /usr/bin gcc-7 -t /usr/bin gcc; sudo ln -srf -t /usr/bin g++-7 -t /usr/bin g++; sudo ln -srf -t /usr/bin cpp-7 -t /usr/bin cpp; sudo ln -srf -t /usr/bin gcc-ar-7 -t /usr/bin gcc-ar; sudo ln -srf -t /usr/bin gcc-nm-7 -t /usr/bin gcc-nm; sudo ln -srf -t /usr/bin gcc-ranlib-7 -t /usr/bin gcc-ranlib; fi
  - if [ "$TRAVIS_OS_NAME-$CXX" = "linux-clang++" ]; then sudo -E apt-get -yq --no-install-suggests --no-install-recommends --force-yes install clang clang-3.8; echo "deb http://ftp.us.debian.org/debian unstable main contrib non-free" | sudo tee -a /etc/apt/sources.list > /dev/null; export DEBIAN_FRONTEND=noninteractive; sudo -E apt-get -yq update &>> ~/apt-get-update.log; sudo -E apt-get -yq --no-install-suggests --no-install-recommends --force-yes install qt5-qmake; sudo ln -srf -t /usr/bin asan_symbolize-3.8 asan_symbolize; sudo ln -srf -t /usr/bin c-index-test-3.8 c-index-test; sudo ln -srf -t /usr/bin clang++-3.8 clang++; sudo ln -srf -t /usr/bin clang-3.8 clang; sudo ln -srf -t /usr/bin clang-apply-replacements-3.8 clang-apply-replacements; sudo ln -srf -t /usr/bin clang-check-3.8 clang-check; sudo ln -srf -t /usr/bin clang-cl-3.8 clang-cl; sudo ln -srf -t /usr/bin clang-include-fixer-3.8 clang-include-fixer; sudo ln -srf -t /usr/bin clang-query-3.8 clang-query; sudo ln -srf -t /usr/bin clang-rename-3.8 clang-rename; sudo ln -srf -t /usr/bin find-all-symbols-3.8 find-all-symbols; sudo ln -srf -t /usr/bin modularize-3.8 modularize; sudo ln -srf -t /usr/bin sancov-3.8 sancov; sudo ln -srf -t /usr/bin scan-build-3.8 scan-build; sudo ln -srf -t /usr/bin scan-build-py-3.8 scan-build-py; sudo ln -srf -t /usr/bin scan-view-3.8 scan-view; fi
  - if [ "$TRAVIS_OS_NAME" = "osx" ]; then brew install qt; fi
before_script:
  - git clone https://github.com/GravisZro/pdtk.git ../pdtk
script:
  - SPEC=$(echo $TRAVIS_OS_NAME-$CC | sed -e s/osx/macx/ -e s/gcc/g++/ -e s/\\\(.*\\\)-clang/unsupported\\/\\1-clang/)
  - clang++ --version
  - qmake sxconfig.pro -spec $SPEC CONFIG+=debug && make
